This is a list of actions for setting up (or upgrading to) the latest version of the QSAR Model Reporting Format Inventory database.

1) Please skip this step if you have an existing database instance named qmrf_documents. If qmrf_documents does not exist, run the following commands in a mysql console:

mysql -uroot -p
create database qmrf_documents;
GRANT ALL ON `qmrf_documents`.* TO 'guest'@'localhost';
use qmrf_documents;
source `qmrf_documents-20120217.sql`;

Please note that the file qmrf_documents-20120217.sql should contain the most recent dump of the old qmrf_documents database and should be located in the current folder.

2) Create the new qmrf database, set up corresponding grants and create the tables that are required. Use the qmrf.sql script from MIGRATION directory. Alternatively, download the qmrf.sql script from:

http://svn.code.sf.net/p/qmrf/code/trunk/qmrf-web/qmrf-db/src/main/resources/net/idea/rest/protocol/db/sql/qmrf.sql?format=raw

Run the following commands in a mysql console:

mysql -uroot -p
create database qmrf character set utf8;
GRANT ALL ON qmrf.* TO 'guest'@'localhost';
use qmrf;
source qmrf.sql;

Please note that the file qmrf.sql should be located in the current folder.

3) Migrate the content from the old database (qmrf_documents) into the new one (qmrf).  Use the migrate.sql script from MIGRATION directory. Alternatively, download the migrate.sql script from:

http://svn.code.sf.net/p/qmrf/code/trunk/qmrf-web/qmrf-db/src/main/resources/net/idea/rest/protocol/db/sql/migrate.sql?format=raw

Run the following commands in a mysql console:

$mysql -uroot -p
use qmrf;
source migrate.sql;

Please note that the file migrate.sql should be located in the current folder.

4) Create the chemical structures database, populate it with data and set up associated grants. Run the following commands in a mysql console:

$mysql -uroot -p
source ambit2-qmrf.sql;
GRANT ALL ON `ambit2-qmrf`.* TO 'guest'@'localhost';

Please note that the file ambit2-qmrf.sql is provided in this archive and should be placed in the current folder.

5) Please skip this step if the tomcat_users database exists already. If the tomcat_users database does not exist, run the following commands in a mysql console:

$mysql -uroot -p
create database tomcat_users;
use tomcat_users;
source tomcat_users.sql;
GRANT ALL ON `tomcat_users`.* TO 'guest'@'localhost';

Please note that the file tomcat_users.sql is provided in this archive and should be placed in the current folder.

6) Deploy the qmrfdata.war in your Tomcat instance. The qmrfdata.war is in the WebApplications directory. Open the following URI in your browser:

http://yourhost:port/qmrfdata/dataset

The browser should display the training and validation datasets.

7) Undeploy the old qmrf.war and deploy the new qmrf.war (included in this archive) in your Tomcat instance. Open the following URI in your browser:

http://yourhost:port/qmrf

The browser should display the first 10 QMRF documents.

8) Change some configuration settings for the qmrf web application (required only if your setup differs from the defaults). Open and edit the {tomcat-dir}/webapps/qmrf/WEB-INF/classes/config/qmrf.properties file.

#File path to store attachments. If null will use the temp folder <<<< REPLACE with the folder where attachments are stored (you could reuse the existing folder from your previous setup; please note that Tomcat should have read and write access to this folder;
qmrf_attachments_dir=/srv/qmrf-docs

#If not defined correctly, query by structure will not be available
qmrf_ambit_service=http://qsardb.jrc.it/qmrfdata  <<<< REPLACE with http://yourhost:port/qmrfdata/ where yourhost is the fully qualified domain name of the host, running the Tomcat instance in which the qmrfdata web application hase been deployed.

Please note that you should restart Tomcat to make sure that the config changes you've eventually made are reflected.

9) Optionally remove old databases which are not needed anymore. You might want to ensure that you have recent dumps of these databases before droping them. Run the following commands in a mysql console:

mysql -uroot -p
drop database qmrf_documents;
drop database ambit_qmrf;
